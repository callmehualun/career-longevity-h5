<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>职场续命力测评</title>
  <link rel="stylesheet" href="css/common.css">
  <style>
    body {
      background: white;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .assessment-header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: white;
      border-bottom: 1px solid #F3F4F6;
      z-index: 100;
    }

    .header-content {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 16px 24px;
      max-width: 600px;
      margin: 0 auto;
    }

    .back-btn {
      flex-shrink: 0;
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #F3F4F6;
      border-radius: 8px;
      cursor: pointer;
      border: none;
      font-size: 20px;
    }

    .progress-container {
      flex: 1;
    }

    .progress-text {
      font-size: 13px;
      font-weight: 600;
      color: #6B7280;
      margin-bottom: 8px;
    }

    .assessment-main {
      flex: 1;
      padding-top: 80px;
      padding-bottom: 100px;
      overflow-y: auto;
    }

    .question-container {
      max-width: 600px;
      margin: 0 auto;
      padding: 32px 24px;
    }

    .question-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 20px;
    }

    .question-dimension {
      font-size: 13px;
      color: #9CA3AF;
    }

    .question-text {
      font-size: 20px;
      font-weight: 700;
      color: #111827;
      line-height: 1.5;
      margin-bottom: 32px;
    }

    .options-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .option-card {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 20px;
      background: white;
      border: 2px solid #E5E7EB;
      border-radius: 12px;
      cursor: pointer;
      transition: all 200ms;
    }

    .option-card:hover {
      border-color: #FF6B4A;
      background: #FFF5F3;
    }

    .option-card.selected {
      border-color: #FF6B4A;
      background: linear-gradient(135deg, #FFE8E3 0%, #FFF5F3 100%);
    }

    .option-label {
      flex-shrink: 0;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #F3F4F6;
      border-radius: 8px;
      font-weight: 600;
      color: #6B7280;
      transition: all 200ms;
    }

    .option-card.selected .option-label {
      background: #FF6B4A;
      color: white;
    }

    .option-text {
      flex: 1;
      font-size: 16px;
      color: #111827;
    }

    .option-check {
      flex-shrink: 0;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #10B981;
      border-radius: 50%;
      color: white;
      font-size: 14px;
      font-weight: 700;
    }

    .assessment-footer {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: white;
      border-top: 1px solid #F3F4F6;
      padding: 16px 24px;
    }

    .footer-content {
      max-width: 600px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      gap: 12px;
    }

    .btn-nav {
      padding: 12px 24px;
      font-size: 15px;
    }
  </style>
</head>
<body>
  <div class="assessment-header">
    <div class="header-content">
      <button class="back-btn" onclick="handleBack()">←</button>
      <div class="progress-container">
        <div class="progress-text" id="progressText">1/24</div>
        <div class="progress">
          <div class="progress-bar" id="progressBar" style="width: 4%;"></div>
        </div>
      </div>
    </div>
  </div>

  <div class="assessment-main">
    <div class="question-container">
      <div class="question-header">
        <span class="badge badge-primary" id="questionBadge">第 1 题</span>
        <span class="question-dimension" id="questionDimension">技能迭代力</span>
      </div>

      <div class="question-text" id="questionText">
        最近1年,你主动学习并应用到工作中的新技能有几个?
      </div>

      <div class="options-list" id="optionsList">
        <!-- 选项将通过 JS 动态生成 -->
      </div>
    </div>
  </div>

  <div class="assessment-footer">
    <div class="footer-content">
      <button class="btn btn-secondary btn-nav" id="prevBtn" onclick="prevQuestion()" style="display: none;">
        上一题
      </button>
      <div style="flex: 1;"></div>
      <button class="btn btn-primary btn-nav" id="nextBtn" onclick="nextQuestion()" disabled>
        下一题
      </button>
    </div>
  </div>

  <script src="data/questions.js"></script>
  <script src="js/assessment.js"></script>
  <script>
    let currentIndex = 0;
    let answers = {};

    // 从 localStorage 恢复进度
    const savedAnswers = localStorage.getItem('assessment_answers');
    const savedIndex = localStorage.getItem('current_question');

    if (savedAnswers) {
      answers = JSON.parse(savedAnswers);
    }

    if (savedIndex) {
      currentIndex = parseInt(savedIndex);
    }

    // 加载题目
    function loadQuestion(index) {
      const question = CareerData.questions[index];
      const progress = Math.round(((index + 1) / CareerData.questions.length) * 100);

      // 更新进度
      document.getElementById('progressText').textContent = `${index + 1}/${CareerData.questions.length}`;
      document.getElementById('progressBar').style.width = progress + '%';

      // 更新题目
      document.getElementById('questionBadge').textContent = `第 ${index + 1} 题`;

      // 获取维度名称
      const dimension = Object.values(CareerData.dimensions).find(d => d.id === question.dimension);
      document.getElementById('questionDimension').textContent = dimension ? dimension.name : '';

      document.getElementById('questionText').textContent = question.question;

      // 生成选项
      const optionsList = document.getElementById('optionsList');
      optionsList.innerHTML = '';

      question.options.forEach((option, optIndex) => {
        const isSelected = answers[question.id] === optIndex;

        const optionCard = document.createElement('div');
        optionCard.className = 'option-card' + (isSelected ? ' selected' : '');
        optionCard.onclick = () => selectOption(optIndex);

        optionCard.innerHTML = `
          <div class="option-label">${option.label}</div>
          <div class="option-text">${option.text}</div>
          ${isSelected ? '<div class="option-check">✓</div>' : ''}
        `;

        optionsList.appendChild(optionCard);
      });

      // 更新按钮状态
      document.getElementById('prevBtn').style.display = index > 0 ? 'block' : 'none';

      const nextBtn = document.getElementById('nextBtn');
      nextBtn.disabled = answers[question.id] === undefined;

      if (index === CareerData.questions.length - 1) {
        nextBtn.textContent = '查看结果';
      } else {
        nextBtn.textContent = '下一题';
      }
    }

    // 选择选项
    function selectOption(optionIndex) {
      const question = CareerData.questions[currentIndex];

      // 保存答案
      answers[question.id] = optionIndex;

      // 保存到 localStorage
      localStorage.setItem('assessment_answers', JSON.stringify(answers));
      localStorage.setItem('current_question', currentIndex);

      // 重新渲染当前题目
      loadQuestion(currentIndex);

      // 自动进入下一题(延迟300ms)
      setTimeout(() => {
        nextQuestion();
      }, 300);
    }

    // 上一题
    function prevQuestion() {
      if (currentIndex > 0) {
        currentIndex--;
        localStorage.setItem('current_question', currentIndex);
        loadQuestion(currentIndex);
      }
    }

    // 下一题
    function nextQuestion() {
      const question = CareerData.questions[currentIndex];

      // 检查是否已选择
      if (answers[question.id] === undefined) {
        alert('请选择一个选项');
        return;
      }

      if (currentIndex < CareerData.questions.length - 1) {
        currentIndex++;
        localStorage.setItem('current_question', currentIndex);
        loadQuestion(currentIndex);
      } else {
        // 所有题目完成,计算结果
        submitAssessment();
      }
    }

    // 提交测评
    function submitAssessment() {
      // 检查是否所有题目都已回答
      const answeredCount = Object.keys(answers).length;
      if (answeredCount < CareerData.questions.length) {
        alert('请完成所有题目');
        return;
      }

      // 计算结果
      const result = CareerAssessment.calculateAssessment(answers, CareerData.questions);

      // 保存结果
      localStorage.setItem('assessment_result', JSON.stringify(result));
      localStorage.setItem('assessment_answers', JSON.stringify(answers));

      // 跳转到结果页
      window.location.href = 'result.html';
    }

    // 返回按钮
    function handleBack() {
      if (confirm('退出后当前进度将不会保存,确认退出?')) {
        window.location.href = 'index.html';
      }
    }

    // 初始加载
    loadQuestion(currentIndex);
  </script>
</body>
</html>
